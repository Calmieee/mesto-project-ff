(()=>{"use strict";var t=document.querySelectorAll(".popup");function e(e){"Escape"===e.key&&t.forEach(o)}function n(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}var r={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2/",headers:{authorization:"1873c1c3-e0d3-46cb-8071-4941cc4e909d","Content-Type":"application/json"}};function c(t,e){return fetch("".concat(t.baseUrl).concat(e),{headers:t.headers})}function a(t,e,n,o){return fetch("".concat(t.baseUrl,"cards/likes/").concat(e),{method:n,headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t),o.textContent=t.likes.length})).catch((function(t){console.log(t)}))}var u=document.querySelector("#card-template").content,i="bd93af4bf4950e32576412f9",l=document.querySelector(".popup.popup_type_submit-delete"),s=l.querySelector(".button.popup__button");function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var d=function(t){return(e=t,function(t){if(Array.isArray(t))return p(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).some((function(t){return!t.validity.valid}));var e};function f(t,e,n){d(e)?(t.classList.add(n.inactiveButtonClass),t.disabled="disabled"):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)}function _(t,e){var n=t.querySelectorAll(".error"),o=t.querySelectorAll(e.inputSelector),r=t.querySelector(e.submitButtonSelector);n.forEach((function(t){t.textContent=""})),o.forEach((function(t){t.classList.remove("popup__input_state_invalid"),t.setCustomValidity("")})),f(r,o,e)}function m(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return y(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var v,b=document.querySelector(".places__list"),h=document.querySelector(".popup.popup_type_edit"),S=document.querySelector(".popup.popup_type_new-card"),g=document.querySelector(".profile.page__section"),k=g.querySelector(".profile__image"),q=g.querySelector(".profile__edit-avatar-button"),E=g.querySelector(".profile__edit-button"),C=g.querySelector(".profile__add-button"),L=g.querySelector(".profile__title"),j=g.querySelector(".profile__description"),A=document.forms["edit-profile"],I=A.querySelector(".popup__input.popup__input_type_name"),x=A.querySelector(".popup__input.popup__input_type_description"),P=document.forms["new-place"],w=P.querySelector(".popup__input.popup__input_type_card-name"),O=P.querySelector(".popup__input.popup__input_type_url"),U=document.querySelector(".popup.popup_type_image"),T=U.querySelector(".popup__image"),B=U.querySelector(".popup__caption"),D=document.querySelector(".popup.popup_type_change-avatar"),M=document.forms["change-avatar"],N=M.querySelector(".popup__input.popup__input_type_url-avatar"),J=A.querySelector(".button.popup__button"),V=P.querySelector(".button.popup__button"),H=M.querySelector(".button.popup__button"),$={deleteCallback:function(t,e,n){!function(t,e,n){n&&fetch("".concat(t.baseUrl,"cards/").concat(e),{method:"DELETE",headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).catch((function(t){console.log(t)}))}(r,e,n),t.closest(".places__item.card").remove()},likeCallback:function(t,e,n){t.classList.toggle("card__like-button_is-active")?a(r,e,"PUT",n):a(r,e,"DELETE",n)},openImgCallbak:function(t){t.addEventListener("click",(function(){T.src=t.src,T.alt=t.alt,B.textContent=T.alt.split(" ― ").pop(),n(U)}))}},z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_state_invalid"};function F(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",r=function(t,e){var r=u.querySelector(".places__item.card").cloneNode(!0),c=r.querySelector(".card__delete-button"),a=r.querySelector(".card__like-button"),p=r.querySelector(".card__image"),d=r.querySelector(".card__like-counter");function f(n){n.target===s&&(e.deleteCallback(c,t._id,!0),s.removeEventListener("click",f),o(l))}return p.src=t.link,p.alt="Это пейзаж из места со следующим названием ― ".concat(t.name),r.querySelector(".card__title").textContent=t.name,d.textContent=t.likes.length,t.likes.forEach((function(t){i===t._id&&a.classList.add("card__like-button_is-active")})),t.owner._id!==i?c.classList.add("card__delete-button-hidden"):c.addEventListener("click",(function(){n(l),s.addEventListener("click",f)})),a.addEventListener("click",(function(){e.likeCallback(a,t._id,d)})),e.openImgCallbak(p),r}(t,$);b[e](r)}function G(t,e){e.textContent=t?"Сохранение...":"Сохранить"}Promise.all([c(r,"users/me"),c(r,"cards")]).then((function(t){var e=m(t,2),n=e[0],o=e[1];return n.ok&&o.ok?Promise.all([n.json(),o.json()]):Promise.reject("Ошибка: ".concat(n.status," и ").concat(o.status))})).then((function(t){var e=m(t,2),n=e[0],o=e[1];L.textContent=n.name,j.textContent=n.about,k.style.backgroundImage="url('".concat(n.avatar,"')"),o.forEach((function(t){F(t,"append")}))})).catch((function(t){var e=m(t,2),n=e[0],o=e[1];console.log(n+o)})),t.forEach((function(t){t.classList.add("popup_is-animated")})),function(t){t.forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&o(t)}))}))}(t),v=z,document.querySelectorAll(v.formSelector).forEach((function(t){!function(t,e){var n=t.querySelectorAll(e.inputSelector),o=t.querySelector(e.submitButtonSelector);f(o,n,e),n.forEach((function(r){r.addEventListener("input",(function(){f(o,n,e),function(t,e,n){var o=t.validity.valid,r=e.querySelector("#".concat(t.name,"-error"));t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),o?function(t,e,n){t.classList.remove(n.inputErrorClass),e.textContent=""}(t,r,n):function(t,e,n){t.classList.add(n.inputErrorClass),e.textContent=t.validationMessage}(t,r,n)}(r,t,e)}))})),t.addEventListener("submit",(function(t){t.preventDefault()}))}(t,v)})),E.addEventListener("click",(function(){I.value=L.textContent,x.value=j.textContent,_(A,z),n(h)})),C.addEventListener("click",(function(){n(S)})),q.addEventListener("click",(function(){N.value=k.style.backgroundImage.slice(5,-2),_(M,z),n(D)})),A.addEventListener("submit",(function(t){t.preventDefault(),G(!0,J),function(t,e){return fetch("".concat(t.baseUrl,"users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e.nameInput,about:e.aboutInput})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(r,{nameInput:I.value,aboutInput:x.value}).then((function(t){L.textContent=t.name,j.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){G(!1,J)})),o(h)})),P.addEventListener("submit",(function(t){G(!0,V),t.preventDefault(),function(t,e){return fetch("".concat(t.baseUrl,"cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e.namePlaceInput,link:e.linkInput})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(r,{namePlaceInput:w.value,linkInput:O.value}).then((function(t){F(t)})).catch((function(t){console.log(t)})).finally((function(){G(!1,V)})),o(S),t.target.reset(),_(P,z)})),M.addEventListener("submit",(function(t){t.preventDefault(),G(!0,H),function(t,e,n){return fetch("".concat(t.baseUrl,"users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t),n.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.log(t)}))}(r,N.value,k).finally((function(){G(!1,H)})),o(D)}))})();