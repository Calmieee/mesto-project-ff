(()=>{"use strict";var t=document.querySelectorAll(".popup");function e(e){"Escape"===e.key&&t.forEach(o)}function n(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}var r={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2/",headers:{authorization:"1873c1c3-e0d3-46cb-8071-4941cc4e909d","Content-Type":"application/json"}};function c(t){return fetch("".concat(r.baseUrl).concat(t),{headers:r.headers})}var a=document.querySelector("#card-template").content;function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function i(t,e,n){var o=t.validity.valid,r=e.querySelector("#".concat(t.name,"-error")),c=e.querySelector(n.submitButtonSelector);t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),o?function(t,e,n){t.classList.remove(n.inputErrorClass),e.textContent=""}(t,r,n):function(t,e,n){t.classList.add(n.inputErrorClass),e.textContent=t.validationMessage}(t,r,n),s(c,e.querySelectorAll(n.inputSelector),n)}var l=function(t){return(e=t,function(t){if(Array.isArray(t))return u(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return u(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).some((function(t){return!t.validity.valid}));var e};function s(t,e,n){l(e)?(t.classList.add(n.inactiveButtonClass),t.disabled="disabled"):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)}function p(t,e){var n=t.querySelectorAll(".error"),o=t.querySelectorAll(e.inputSelector),r=t.querySelector(e.submitButtonSelector);n.forEach((function(t){t.textContent=""})),o.forEach((function(t){t.classList.remove("popup__input_state_invalid"),t.setCustomValidity("")})),s(r,o,e)}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,c,a,u=[],i=!0,l=!1;try{if(c=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=c.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw r}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var _,m,y,v,b=document.querySelector(".places__list"),h=document.querySelector(".popup.popup_type_edit"),S=document.querySelector(".popup.popup_type_new-card"),g=document.querySelector(".profile.page__section"),k=g.querySelector(".profile__image"),q=g.querySelector(".profile__edit-avatar-button"),E=g.querySelector(".profile__edit-button"),C=g.querySelector(".profile__add-button"),L=g.querySelector(".profile__title"),j=g.querySelector(".profile__description"),A=document.forms["edit-profile"],I=A.querySelector(".popup__input.popup__input_type_name"),x=A.querySelector(".popup__input.popup__input_type_description"),P=document.forms["new-place"],w=P.querySelector(".popup__input.popup__input_type_card-name"),O=P.querySelector(".popup__input.popup__input_type_url"),U=document.querySelector(".popup.popup_type_image"),T=U.querySelector(".popup__image"),B=U.querySelector(".popup__caption"),D=document.querySelector(".popup.popup_type_change-avatar"),M=document.forms["change-avatar"],N=M.querySelector(".popup__input.popup__input_type_url-avatar"),J=A.querySelector(".button.popup__button"),V=P.querySelector(".button.popup__button"),H=M.querySelector(".button.popup__button"),$=document.querySelector(".popup.popup_type_submit-delete"),z=$.querySelector(".button.popup__button"),F={deleteCallback:K,likeCallback:function(t,e,n){(function(t,e){return fetch("".concat(r.baseUrl,"cards/likes/").concat(t),{method:e,headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))})(e,t.classList.contains("card__like-button_is-active")?"DELETE":"PUT").then((function(e){n.textContent=e.likes.length,t.classList.toggle("card__like-button_is-active")})).catch((function(t){console.log(t)}))},openImgCallbak:function(t){t.addEventListener("click",(function(){T.src=t.src,T.alt=t.alt,B.textContent=T.alt.split(" ― ").pop(),n(U)}))},addListenerCallbak:function(t,e,o){t.addEventListener("click",(function(){m=e,y=o,n($)}))}},G={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_state_invalid"};function K(t,e,n){(function(t,e){if(e)return fetch("".concat(r.baseUrl,"cards/").concat(t),{method:"DELETE",headers:r.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))})(e,n).then((function(){t.remove(),o($)})).catch((function(t){console.log(t)}))}function Q(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",n=function(t,e,n){var o=a.querySelector(".places__item.card").cloneNode(!0),r=o.querySelector(".card__delete-button"),c=o.querySelector(".card__like-button"),u=o.querySelector(".card__image"),i=o.querySelector(".card__like-counter");return u.src=t.link,u.alt="Это пейзаж из места со следующим названием ― ".concat(t.name),o.querySelector(".card__title").textContent=t.name,i.textContent=t.likes.length,t.likes.forEach((function(t){n===t._id&&c.classList.add("card__like-button_is-active")})),t.owner._id!==n?r.classList.add("card__delete-button-hidden"):e.addListenerCallbak(r,t._id,o),c.addEventListener("click",(function(){e.likeCallback(c,t._id,i)})),e.openImgCallbak(u),o}(t,F,_);b[e](n)}function R(t,e){e.textContent=t?"Сохранение...":"Сохранить"}Promise.all([c("users/me"),c("cards")]).then((function(t){var e=d(t,2),n=e[0],o=e[1];return n.ok&&o.ok?Promise.all([n.json(),o.json()]):Promise.reject("Ошибка: ".concat(n.status," и ").concat(o.status))})).then((function(t){var e=d(t,2),n=e[0],o=e[1];L.textContent=n.name,j.textContent=n.about,k.style.backgroundImage="url('".concat(n.avatar,"')"),_=n._id,o.forEach((function(t){Q(t,"append")}))})).catch((function(t){console.log(t)})),t.forEach((function(t){t.classList.add("popup_is-animated")})),function(t){t.forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&o(t)}))}))}(t),v=G,document.querySelectorAll(v.formSelector).forEach((function(t){!function(t,e){var n=t.querySelectorAll(e.inputSelector),o=t.querySelector(e.submitButtonSelector);s(o,n,e),n.forEach((function(r){r.addEventListener("input",(function(){s(o,n,e),i(r,t,e)})),r.addEventListener("keyup",(function(){i(r,t,e)}))})),t.addEventListener("submit",(function(t){t.preventDefault()}))}(t,v)})),E.addEventListener("click",(function(){I.value=L.textContent,x.value=j.textContent,p(A,G),n(h)})),C.addEventListener("click",(function(){n(S)})),q.addEventListener("click",(function(){N.value=k.style.backgroundImage.slice(5,-2),p(M,G),n(D)})),z.addEventListener("click",(function(t){t.target===z&&K(y,m,!0)})),A.addEventListener("submit",(function(t){var e;t.preventDefault(),R(!0,J),(e={nameInput:I.value,aboutInput:x.value},fetch("".concat(r.baseUrl,"users/me"),{method:"PATCH",headers:r.headers,body:JSON.stringify({name:e.nameInput,about:e.aboutInput})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){L.textContent=t.name,j.textContent=t.about,o(h)})).catch((function(t){console.log(t)})).finally((function(){R(!1,J)}))})),P.addEventListener("submit",(function(t){var e;R(!0,V),t.preventDefault(),(e={namePlaceInput:w.value,linkInput:O.value},fetch("".concat(r.baseUrl,"cards"),{method:"POST",headers:r.headers,body:JSON.stringify({name:e.namePlaceInput,link:e.linkInput})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(e){Q(e),o(S),t.target.reset(),p(P,G)})).catch((function(t){console.log(t)})).finally((function(){R(!1,V)}))})),M.addEventListener("submit",(function(t){var e;t.preventDefault(),R(!0,H),(e=N.value,fetch("".concat(r.baseUrl,"users/me/avatar"),{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))).then((function(t){k.style.backgroundImage="url('".concat(t.avatar,"')"),o(D)})).catch((function(t){console.log(t)})).finally((function(){R(!1,H)}))}))})();