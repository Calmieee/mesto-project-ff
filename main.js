(()=>{"use strict";var t=document.querySelectorAll(".popup");function e(e){"Escape"===e.key&&t.forEach(o)}function n(t){t.classList.add("popup_is-opened"),document.addEventListener("keydown",e)}function o(t){t.classList.remove("popup_is-opened"),document.removeEventListener("keydown",e)}var r={baseUrl:"https://nomoreparties.co/v1/cohort-magistr-2/",headers:{authorization:"1873c1c3-e0d3-46cb-8071-4941cc4e909d","Content-Type":"application/json"}};function a(t,e){return fetch("".concat(t.baseUrl).concat(e),{headers:t.headers})}function c(t,e,n,o){return fetch("".concat(t.baseUrl,"cards/likes/").concat(e),{method:n,headers:t.headers}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t),o.textContent=t.likes.length})).catch((function(t){console.log(t)}))}var u=document.querySelector("#card-template").content,i="bd93af4bf4950e32576412f9";function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var s=function(t){return(e=t,function(t){if(Array.isArray(t))return l(t)}(e)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(e)||function(t,e){if(t){if("string"==typeof t)return l(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(t,e):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).some((function(t){return!t.validity.valid}));var e};function p(t,e,n){s(e)?(t.classList.add(n.inactiveButtonClass),t.disabled="disabled"):(t.classList.remove(n.inactiveButtonClass),t.disabled=!1)}function d(t,e){var n=t.querySelectorAll(".error"),o=t.querySelectorAll(e.inputSelector),r=t.querySelector(e.submitButtonSelector);n.forEach((function(t){t.textContent=""})),o.forEach((function(t){t.classList.remove("popup__input_state_invalid"),t.setCustomValidity("")})),p(r,o,e)}function f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var o,r,a,c,u=[],i=!0,l=!1;try{if(a=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;i=!1}else for(;!(i=(o=a.call(n)).done)&&(u.push(o.value),u.length!==e);i=!0);}catch(t){l=!0,r=t}finally{try{if(!i&&null!=n.return&&(c=n.return(),Object(c)!==c))return}finally{if(l)throw r}}return u}}(t,e)||function(t,e){if(t){if("string"==typeof t)return _(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var m,y=document.querySelector(".places__list"),v=document.querySelector(".popup.popup_type_edit"),b=document.querySelector(".popup.popup_type_new-card"),h=document.querySelector(".profile.page__section"),S=h.querySelector(".profile__image"),g=h.querySelector(".profile__edit-avatar-button"),k=h.querySelector(".profile__edit-button"),q=h.querySelector(".profile__add-button"),E=h.querySelector(".profile__title"),C=h.querySelector(".profile__description"),L=document.forms["edit-profile"],j=L.querySelector(".popup__input.popup__input_type_name"),A=L.querySelector(".popup__input.popup__input_type_description"),I=document.forms["new-place"],x=I.querySelector(".popup__input.popup__input_type_card-name"),P=I.querySelector(".popup__input.popup__input_type_url"),w=document.querySelector(".popup.popup_type_image"),O=w.querySelector(".popup__image"),U=w.querySelector(".popup__caption"),T=document.querySelector(".popup.popup_type_change-avatar"),B=document.forms["change-avatar"],D=B.querySelector(".popup__input.popup__input_type_url-avatar"),M=L.querySelector(".button.popup__button"),N=I.querySelector(".button.popup__button"),J=B.querySelector(".button.popup__button"),V={deleteCallback:function(t,e){!function(t,e){fetch("".concat(t.baseUrl,"cards/").concat(e),{method:"DELETE",headers:t.headers})}(r,e),t.closest(".places__item.card").remove()},likeCallback:function(t,e,n){t.classList.toggle("card__like-button_is-active")?c(r,e,"PUT",n):c(r,e,"DELETE",n)},openImgCallbak:function(t){t.addEventListener("click",(function(){O.src=t.src,O.alt=t.alt,U.textContent=O.alt.split(" ― ").pop(),n(w)}))}},H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_inactive",inputErrorClass:"popup__input_state_invalid"};function $(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"prepend",n=function(t,e){var n=u.querySelector(".places__item.card").cloneNode(!0),o=n.querySelector(".card__delete-button"),r=n.querySelector(".card__like-button"),a=n.querySelector(".card__image"),c=n.querySelector(".card__like-counter");return a.src=t.link,a.alt="Это пейзаж из места со следующим названием ― ".concat(t.name),n.querySelector(".card__title").textContent=t.name,c.textContent=t.likes.length,t.likes.forEach((function(t){i===t._id&&r.classList.add("card__like-button_is-active")})),t.owner._id!==i?o.classList.add("card__delete-button-hidden"):o.addEventListener("click",(function(){e.deleteCallback(o,t._id)})),r.addEventListener("click",(function(){e.likeCallback(r,t._id,c)})),e.openImgCallbak(a),n}(t,V);y[e](n)}function z(t,e){e.textContent=t?"Сохранение...":"Сохранить"}Promise.all([a(r,"users/me"),a(r,"cards")]).then((function(t){var e=f(t,2),n=e[0],o=e[1];return n.ok&&o.ok?Promise.all([n.json(),o.json()]):Promise.reject("Ошибка: ".concat(res.status))})).then((function(t){var e=f(t,2),n=e[0],o=e[1];E.textContent=n.name,C.textContent=n.about,S.style.backgroundImage="url('".concat(n.avatar,"')"),o.forEach((function(t){$(t,"append")}))})).catch((function(t){var e=f(t,2),n=e[0],o=e[1];console.log(n+o)})),t.forEach((function(t){t.classList.add("popup_is-animated")})),function(t){t.forEach((function(t){t.addEventListener("click",(function(e){(e.target.classList.contains("popup__close")||e.target.classList.contains("popup"))&&o(t)}))}))}(t),m=H,document.querySelectorAll(m.formSelector).forEach((function(t){!function(t,e){var n=t.querySelectorAll(e.inputSelector),o=t.querySelector(e.submitButtonSelector);p(o,n,e),n.forEach((function(r){r.addEventListener("input",(function(){p(o,n,e),function(t,e,n){var o=t.validity.valid,r=e.querySelector("#".concat(t.name,"-error"));t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),o?function(t,e,n){t.classList.remove(n.inputErrorClass),e.textContent=""}(t,r,n):function(t,e,n){t.classList.add(n.inputErrorClass),e.textContent=t.validationMessage}(t,r,n)}(r,t,e)}))})),t.addEventListener("submit",(function(t){t.preventDefault()}))}(t,m)})),k.addEventListener("click",(function(){j.value=E.textContent,A.value=C.textContent,d(L,H),n(v)})),q.addEventListener("click",(function(){n(b)})),g.addEventListener("click",(function(){D.value=S.style.backgroundImage.slice(5,-2),d(B,H),n(T)})),L.addEventListener("submit",(function(t){t.preventDefault(),z(!0,M),function(t,e){return fetch("".concat(t.baseUrl,"users/me"),{method:"PATCH",headers:t.headers,body:JSON.stringify({name:e.nameInput,about:e.aboutInput})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(r,{nameInput:j.value,aboutInput:A.value}).then((function(t){E.textContent=t.name,C.textContent=t.about})).catch((function(t){console.log(t)})).finally((function(){z(!1,M)})),o(v)})),I.addEventListener("submit",(function(t){z(!0,N),t.preventDefault(),function(t,e){return fetch("".concat(t.baseUrl,"cards"),{method:"POST",headers:t.headers,body:JSON.stringify({name:e.namePlaceInput,link:e.linkInput})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))}))}(r,{namePlaceInput:x.value,linkInput:P.value}).then((function(t){$(t)})).catch((function(t){console.log(t)})).finally((function(){z(!1,N)})),o(b),t.target.reset(),d(I,H)})),B.addEventListener("submit",(function(t){t.preventDefault(),z(!0,J),function(t,e,n){return fetch("".concat(t.baseUrl,"users/me/avatar"),{method:"PATCH",headers:t.headers,body:JSON.stringify({avatar:e})}).then((function(t){return t.ok?t.json():Promise.reject("Ошибка: ".concat(t.status))})).then((function(t){console.log(t),n.style.backgroundImage="url('".concat(t.avatar,"')")})).catch((function(t){console.log(t)}))}(r,D.value,S).finally((function(){z(!1,J)})),o(T)}))})();